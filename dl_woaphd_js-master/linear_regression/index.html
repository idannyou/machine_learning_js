<html>
  <head></head>
  <body>
    <div id="scatter_plot"></div>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@1.0.0/dist/tfjs-vis.umd.min.js"></script>

    <div id="scatter_plot"></div>

    <script>
      let json =
        '[[0.0, -0.9376481349703036], [0.25, 1.8154040316474571], [0.5, 4.037347787786974], [0.75, 2.8516658751717223], [1.0, 6.473055177105756], [1.25, 1.4073710384073044], [1.5, 2.379257858474757], [1.75, 1.5685553128673684], [2.0, 3.8981126531208004], [2.25, 9.481106700991852], [2.5, 7.885624887157341], [2.75, 8.852622425875232], [3.0, 10.704882989599252], [3.25, 8.475273605523851], [3.5, 11.50971475866734], [3.75, 10.150911201906222], [4.0, 8.100758043010103], [4.25, 8.115608704803172], [4.5, 13.669089619866483], [4.75, 9.23168187928837], [5.0, 7.022462189678414], [5.25, 14.376301316671409], [5.5, 11.76511005022105], [5.75, 8.916450614338103], [6.0, 13.395054444437768], [6.25, 12.631422019491872], [6.5, 11.872466421114698], [6.75, 15.543372481055897], [7.0, 11.448006340971896], [7.25, 12.879791360569794], [7.5, 16.808007718918585], [7.75, 15.022485841967818], [8.0, 18.761006493517634], [8.25, 21.29862905696517], [8.5, 16.87124412409302], [8.75, 22.371532596956747], [9.0, 17.23789416934025], [9.25, 22.012234589352715], [9.5, 23.27459201047188], [9.75, 21.119162535559962]]';

      function basicExampleRun() {
        let v = [1, 2, 3, 4];
        let t = tf.tensor1d(v);
        // Data will be missing from t, you need to evaluate tensor to see data
        // t.print();
        t = t.add(1);
        // t.print();
        let v2d = [[1, 2], [3, 4]];
        // multi-dimensional tensors need a shape associated
        let t2d = tf.tensor2d(v2d, [2, 2]);
        // can use list from above and reshape 1d
        let t2dv1 = tf.tensor2d(v, [2, 2]);
        // t2d.print();
        // t2dv1.print();
        let sumV2d = t2d.add(t2dv1);
        // sumV2d.print();
      }
      basicExampleRun();

      function dataExampleRun() {
        const data = JSON.parse(json);

        let xs = data.map(item => item[0]);
        let ys = data.map(item => item[1]);

        let features = tf.tensor2d(xs, [xs.length, 1]);
        let targets = tf.tensor2d(ys, [ys.length, 1]);

        // features.print();
        // targets.print();

        async function trainModel() {
          // A sequential model is one in which the layers are applied in the order they are added to the model
          let model = tf.sequential();

          // units define numbers of outputs
          // inputShape defines number of inputs
          let layer = tf.layers.dense({ units: 1, inputShape: 1 });

          model.add(layer);

          //   .001 is the learning rate
          //   let optimizer = tf.train.sgd(0.001);

          //   hyperparameters are non-trainable values set to configure the network
          model.compile({ loss: 'meanSquaredError', optimizer: 'sgd' });

          //   fit the model to training data
          await model.fit(features, targets, { epochs: 30 });
          return model;
        }

        async function makePredictions() {
          let model = await trainModel();
          let four = tf.tensor1d([4]);
          let prediction = model.predict(four);
          //   prediction should be around 9
          prediction.print();

          let predictions = await model.predict(features).data();
          let container = document.getElementById('scatter_plot');

          let points = {
            values: [data.map(item => ({ x: item[0], y: item[1] }))],
            series: ['Data']
          };

          tfvis.render.scatterplot(container, points, {
            xLabel: 'x',
            ylabel: 'y',
            height: 450,
            fontSize: 16
          });
        }

        makePredictions();
      }

      dataExampleRun();
    </script>
  </body>
</html>
